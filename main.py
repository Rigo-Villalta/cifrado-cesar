####################################################################################
# Como librerias usamos Thinter para entorno gr√°fico para Python
##
import tkinter as tk
from tkinter import simpledialog, messagebox
import subprocess
import hashlib
import os

####################################################################################
# Funci√≥n que encripta la contrase√±a que el usuario ingresa a SHA256 como proteccion
#
def hash_password(password):
    return hashlib.sha256(password.encode()).hexdigest()

####################################################################################
# Si no existe la clave almacenada, genera un archivo y solicita al usuario la clave
##
#def verify_password_file():
#    password_file = "password.sha256"
#    if not os.path.exists(password_file):
#        password = simpledialog.askstring("Nueva Contrase√±a", "Ingrese una nueva contrase√±a de administraci√≥n:", show='*')
#        if password:
#            hashed_password = hash_password(password)
#            with open(password_file, "w") as file:
#                file.write(hashed_password)
#            messagebox.showinfo("Archivo Creado", "Archivo de contrase√±a creado.")
#        else:
#            messagebox.showerror("Error", "No se ingres√≥ una contrase√±a. Se cerrar√° la aplicaci√≥n.")
#            exit()

####################################################################################
# Para realizar cambios en el cifrado cesar o cambio de clave solicita la verificacion de la contrase√±a
##
#def verify_password():
#    with open("password.sha256", "r") as file:
#        stored_password_hash = file.read().strip()
#        entered_password = simpledialog.askstring("Verificaci√≥n", "Ingrese la contrase√±a actual:", show='*')
#        if entered_password is None:
#            return False
#        return hash_password(entered_password) == stored_password_hash

####################################################################################
# Esta funcion valida la existencia del script de configuraci√≥n
##
def open_config_window():
    if os.path.exists("config.py"):
        subprocess.run(["python", "config.py"])
    else:
        messagebox.showerror("Error", "El script de configuraci√≥n no se encuentra.")

####################################################################################
# Llamada al script de cifrado
##
def open_cifrar_window():
    subprocess.run(["python", "cifrar.py"])

####################################################################################
# Llamada al script de descifrado
##
def open_descifrar_window():
    subprocess.run(["python", "descifrar.py"])

####################################################################################
# Si el archivo con el parametro de cifrado no existe lo crea y establece el valor por defecto a 3
##
def check_or_create_config_file():
    config_file = "config.cfg"
    if not os.path.exists(config_file):
        with open(config_file, "w") as file:
            file.write("cesar = 3\n")
        messagebox.showinfo("Configuraci√≥n creada", "Archivo de configuraci√≥n de cifrado creado.")

# Funci√≥n para abrir el script de cr√©ditos
def open_creditos_window():
    subprocess.run(["python", "creditos.py"])



####################################################################################
# Funcion principal y control de aspecto gr√°fico
##
def main_window():
    # Icono, dimensiones de ventana, Imagen de logo y Labels y titulo de ventana
    root = tk.Tk()
    root.iconbitmap('icon.ico')
    root.geometry("300x400")
    logo_image = tk.PhotoImage(file='logo.png')
    logo_image = logo_image.subsample(2, 2)
    logo_label = tk.Label(root, image=logo_image)
    logo_label.image = logo_image  # Keep a reference
    logo_label.pack(pady=10)
    root.title("Men√∫ Principal - Caesar")

    # Label principal 
    cesar_label = tk.Label(root, text='Cifrado C√©sar')
    cesar_label.pack(pady=10)

    # Cifrar
    cifrar_button = tk.Button(root, text="üîí Cifrar", command=open_cifrar_window)
    cifrar_button.pack(pady=10)

    # Descifrar
    descifrar_button = tk.Button(root, text="üîì Descifrar", command=open_descifrar_window)
    descifrar_button.pack(pady=10)

    # Bot√≥n de cr√©ditos
    creditos_button = tk.Button(root, text="üë• Cr√©ditos", command=open_creditos_window)
    creditos_button.pack(side='bottom', anchor='sw', pady=10, padx=10)
    
    # Configurar Contrase√±a/Par√°metro C√©sar
    conf_button = tk.Button(root, text="Configurar ‚öô", command=open_config_window)
    conf_button.pack(side='bottom', anchor='se', pady=10, padx=10)
    root.mainloop()

####################################################################################
# Funciones iniciales
##
if __name__ == "__main__":
    check_or_create_config_file()
    main_window()
